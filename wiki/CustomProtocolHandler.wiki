#summary The xmldb:exist:// custom protocol handler.
#labels Featured,Phase-Implementation

== Custom protocol handler "xmldb:exist://" ==

Under certain conditions it is handy to be able to access data stored in eXist via a *xmldb:exist://* type URL, straight out of javacode. The code below shows how to do this.

[http://www.exist-db.org/ http://www.exist-db.org/logo.jpg]

To be able to use this special URL you can either
 * set the value 'org.exist.protocols' to (java) system property 'java.protocol.handler.pkgs'
 * call URL.setURLStreamHandlerFactory(new eXistURLStreamHandlerFactory());

The code example

{{{
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.MalformedURLException;
import java.net.URL;
import org.exist.protocols.eXistURLStreamHandlerFactory;

...

BasicConfigurator.configure();

// OR use this
System.setProperty( 'java.protocol.handler.pkgs', 'org.exist.protocols' );

// OR use this
URL.setURLStreamHandlerFactory(new eXistURLStreamHandlerFactory());

URL url = new URL('xmldb:exist://guest:guest@localhost:8080/exist/xmlrpc/db/shakespeare/plays/macbeth.xml');
 
InputStream is = url.openStream();
            
... (handle inputstream) ...
            
is.close();
}}}

* Warning !!*
The equivalent for sending data to the database does not work well enough yet. Exceptions are not handled right at this moment. This effect is shown in the jUnit testsuite.

{{{
OutputStream os = url.openConnection().getOutputStream();
}}}

== Dependancies ==
The code does have a dependancy with the eXist jar files, in particular:
 * exist.jar
 * exist-optional.jar (to be checked)
 * log4j-1.2.14.jar
 * xmldb.jar
 * xmlrpc-1.2-patched.jar

== Known Issues ==

 * Error/exception handling for uploading documents not complete yet.
_When a document is uploaded to the eXist-db, and an error occurs (e.g. collection does not exist, unknown user, not authorized), this error is not propagated to the end user. It is caused by a Threading issue, which is difficult to tackle. The issues are shown when running the test suite._








