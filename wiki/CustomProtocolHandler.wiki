#summary The xmldb:exist:// custom protocol handler.

== Custom protocol handler "xmldb:exist://" ==

Under certain conditions it is handy to be able to access data stored in eXist via a *xmldb:exist://* type URL, straight out of javacode. The code below shows how to do this.

To be able to use this special URL you can either
 * set the value 'org.exist.protocols' to (java) system property 'java.protocol.handler.pkgs'
 * call URL.setURLStreamHandlerFactory(new eXistURLStreamHandlerFactory());

The code example

{{{
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.MalformedURLException;
import java.net.URL;
import org.exist.protocols.eXistURLStreamHandlerFactory;

...

BasicConfigurator.configure();

// OR use this
System.setProperty( 'java.protocol.handler.pkgs', 'org.exist.protocols' );

// OR use this
URL.setURLStreamHandlerFactory(new eXistURLStreamHandlerFactory());

URL url = new URL('xmldb:exist://guest:guest@localhost:8080/exist/xmlrpc/db/shakespeare/plays/macbeth.xml');
 
InputStream is = url.openStream();
            
... (handle inputstream) ...
            
is.close();
}}}

* Warning !!*
The equivalent for sending data to the database does not work well enough yet. Exceptions are not handled right at this moment. This effect is shown in the jUnit testsuite.

{{{
OutputStream os = url.openConnection().getOutputStream();
}}}

== Known Issues ==

 * It is not possible to specify "userinfo" in the url (xmldb:exist://username:password@hostname:portnr/exist/xmlrpc/db/collection/doc.xml)
_This is because the eXist *XmldbURI* class does not provide methods to get the username/password yet. Alternatively we could pass a xmldb:exist-uri as a string to the URL class, and get the wanted info via this route. The problem is that we might need to check the correctness of the URL on too many locations_

 * Error/exception handling for uploading documents not complete yet.
_When a document is send to eXist, e.g. to a collection which does not exist, the exception is not propagated. It seems that the 'thread' is never ended. Difficult to tackle, might need to perform a significant rewrite._







